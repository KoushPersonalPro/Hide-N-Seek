(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[422],{4226:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/lobby/[code]",function(){return r(2800)}])},4478:function(e,t,r){"use strict";r.d(t,{O:function(){return n}});var a=r(6490);let n=(0,a.eI)("https://uhseqzovowlatskxmbha.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVoc2Vxem92b3dsYXRza3htYmhhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzI3OTI3OTQsImV4cCI6MjA0ODM2ODc5NH0.KDLOzv0IiURzesIMdWLto2yXG1qqSmCBddXWf554MXI")},2800:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return Lobby}});var a=r(5893),n=r(1163),o=r(7294),s=r(4478);function Lobby(){let e=(0,n.useRouter)(),{code:t}=e.query,[r,l]=(0,o.useState)([]),[i,c]=(0,o.useState)(!1),[d,f]=(0,o.useState)(!0),[u,h]=(0,o.useState)(null);(0,o.useEffect)(()=>{if(!t)return;let fetchGame=async()=>{try{f(!0);let{data:r,error:a}=await s.O.from("games").select("*").eq("code",t).single();if(a)throw a;if(!r)throw Error("Game not found");l(r.players);let{data:n,error:o}=await s.O.auth.getUser();if(o||!n.user){e.push("/");return}c(r.creator_id===n.user.id);let i=r.players.find(e=>e.id===n.user.id);i&&i.color&&h(i.color)}catch(t){console.error("Error fetching game:",t.message),e.push("/")}finally{f(!1)}};fetchGame();let r=s.O.channel("games:".concat(t)).on("postgres_changes",{event:"UPDATE",schema:"public",table:"games",filter:"code=eq.".concat(t)},r=>{l(r.new.players),"playing"===r.new.state.status&&e.push("/game/".concat(t))}).subscribe();return()=>{s.O.removeChannel(r)}},[t,e]);let handleColorSelect=async e=>{if(r.some(t=>t.color===e))return;let{data:a}=await s.O.auth.getUser(),n=r.map(t=>t.id===a.user.id?{...t,color:e}:t);await s.O.from("games").update({players:n}).eq("code",t),h(e)},handleStart=async()=>{if(r.length<=1){alert("Need at least 2 players to start the game!");return}let e=r[Math.floor(Math.random()*r.length)].id,a={status:"playing",finder:e,found:[],startedAt:new Date().toISOString(),timeLimit:300};await s.O.from("games").update({state:a}).eq("code",t)},p=r.every(e=>e.color);return d?(0,a.jsx)("div",{style:{padding:20},children:"Loading..."}):(0,a.jsxs)("div",{style:{padding:20},children:[(0,a.jsxs)("h1",{children:["Lobby - Code: ",t]}),(0,a.jsxs)("h3",{children:["Players (",r.length,"/10):"]}),(0,a.jsx)("ul",{children:r.map(e=>(0,a.jsxs)("li",{children:[e.username," ",e.color?(0,a.jsx)("span",{style:{display:"inline-block",width:15,height:15,background:e.color,borderRadius:"50%",marginLeft:5}}):"(No color selected)"]},e.id))}),(0,a.jsxs)("div",{style:{marginTop:20},children:[(0,a.jsx)("h4",{children:"Select Your Color:"}),(0,a.jsx)("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:["#ff4444","#44ff44","#4444ff","#ffff44","#ff44ff","#44ffff","#ff8844","#8844ff","#44ff88","#ff4488"].map(e=>(0,a.jsx)("button",{onClick:()=>handleColorSelect(e),disabled:r.some(t=>t.color===e)||u,style:{width:30,height:30,background:e,borderRadius:"50%",border:"2px solid #fff",cursor:r.some(t=>t.color===e)||u?"not-allowed":"pointer",opacity:r.some(t=>t.color===e)?.5:1}},e))})]}),i&&(0,a.jsx)("button",{onClick:handleStart,disabled:r.length<=1||!p,style:{padding:"10px 20px",marginTop:20,background:p&&r.length>1?"#44ff44":"#888",cursor:p&&r.length>1?"pointer":"not-allowed"},children:"Start Game"}),(0,a.jsx)("button",{onClick:()=>e.push("/"),style:{padding:"10px 20px",marginTop:20,marginLeft:10},children:"Leave"})]})}}},function(e){e.O(0,[574,774,888,179],function(){return e(e.s=4226)}),_N_E=e.O()}]);
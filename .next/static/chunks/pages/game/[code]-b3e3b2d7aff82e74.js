(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[216],{4592:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/game/[code]",function(){return n(1103)}])},4478:function(e,t,n){"use strict";n.d(t,{O:function(){return i}});var a=n(6490);let i=(0,a.eI)("https://uhseqzovowlatskxmbha.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVoc2Vxem92b3dsYXRza3htYmhhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzI3OTI3OTQsImV4cCI6MjA0ODM2ODc5NH0.KDLOzv0IiURzesIMdWLto2yXG1qqSmCBddXWf554MXI")},1103:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Game}});var a=n(5893),i=n(7294),o=n(1163),r=n(4478);function Player(e){var t;let{x:n=0,y:o=0,username:r,color:l,isFinder:s,isCurrent:d,onMove:c,gameState:u}=e;(0,i.useEffect)(()=>{var e;if(!d||(null===(e=u.found)||void 0===e?void 0:e.includes(r)))return;let handleKeyDown=e=>{let t=n,a=o;switch(e.key){case"ArrowUp":a-=15;break;case"ArrowDown":a+=15;break;case"ArrowLeft":t-=15;break;case"ArrowRight":t+=15;break;default:return}t=Math.max(0,Math.min(780,t)),a=Math.max(0,Math.min(580,a));let i={x:t,y:a,w:20,h:20},r=[{x:20,y:20,w:60,h:40},{x:720,y:540,w:60,h:40},{x:100,y:50,w:80,h:80},{x:150,y:250,w:100,h:60},{x:650,y:150,w:60,h:80},{x:50,y:450,w:80,h:100},{x:600,y:20,w:100,h:120},{x:200,y:350,w:120,h:80},{x:300,y:100,w:200,h:20},{x:50,y:200,w:20,h:150},{x:500,y:400,w:150,h:20},{x:350,y:250,w:150,h:40},{x:200,y:500,w:200,h:40},{x:50,y:350,w:100,h:20},{x:600,y:450,w:20,h:100}].some(e=>i.x<e.x+e.w&&i.x+i.w>e.x&&i.y<e.y+e.h&&i.y+i.h>e.y);r||t===n&&a===o||c(t,a)};return window.addEventListener("keydown",handleKeyDown),()=>window.removeEventListener("keydown",handleKeyDown)},[n,o,d,c,u.found,r]);let h=null===(t=u.found)||void 0===t?void 0:t.includes(r);return(0,a.jsxs)("div",{style:{position:"absolute",left:n,top:o,zIndex:2,transition:"left 0.1s ease-out, top 0.1s ease-out"},children:[(0,a.jsx)("div",{style:{width:20,height:20,background:l||"#888",borderRadius:"50%",border:"2px solid #fff",position:"relative",opacity:h?.3:1,boxShadow:"0 0 5px rgba(255,255,255,0.3)",transition:"opacity 0.3s"}}),(0,a.jsx)("div",{style:{position:"absolute",top:-25,left:"50%",transform:"translateX(-50%)",color:"white",fontSize:12,textShadow:"1px 1px 2px #000",whiteSpace:"nowrap"},children:r}),s&&"playing"===u.status&&(0,a.jsx)("div",{style:{position:"absolute",width:"120px",height:"120px",background:"radial-gradient(circle, rgba(255,255,200,0.4) 0%, rgba(0,0,0,0) 70%)",left:n-50,top:o-50,pointerEvents:"none",zIndex:1,borderRadius:"50%"}}),h&&(0,a.jsx)("div",{style:{position:"absolute",top:0,left:"50%",transform:"translateX(-50%)",color:"red",fontSize:14,fontWeight:"bold",textShadow:"1px 1px 2px #000"},children:"Eliminated"})]})}function GameMap(e){let{players:t,currentPlayerId:n,gameState:o,onMove:r}=e,l=(0,i.useRef)(null);return(0,i.useEffect)(()=>{let e=l.current,t=e.getContext("2d");t.fillStyle="#3a3a3a",t.fillRect(0,0,800,600),[{type:"door",x:20,y:20,w:60,h:40,color:"#2a2a5a"},{type:"door",x:720,y:540,w:60,h:40,color:"#2a2a5a"},{type:"crate",x:100,y:50,w:80,h:80,color:"#4a2c1d"},{type:"crate",x:150,y:250,w:100,h:60,color:"#4a2c1d"},{type:"crate",x:650,y:150,w:60,h:80,color:"#4a2c1d"},{type:"crate",x:50,y:450,w:80,h:100,color:"#4a2c1d"},{type:"machinery",x:600,y:20,w:100,h:120,color:"#5a5a5a"},{type:"machinery",x:200,y:350,w:120,h:80,color:"#5a5a5a"},{type:"pipe",x:300,y:100,w:200,h:20,color:"#8a8a8a"},{type:"pipe",x:50,y:200,w:20,h:150,color:"#8a8a8a"},{type:"pipe",x:500,y:400,w:150,h:20,color:"#8a8a8a"},{type:"belt",x:350,y:250,w:150,h:40,color:"#3a3a5a"},{type:"belt",x:200,y:500,w:200,h:40,color:"#3a3a5a"},{type:"wall",x:50,y:350,w:100,h:20,color:"#6a6a6a"},{type:"wall",x:600,y:450,w:20,h:100,color:"#6a6a6a"}].forEach(e=>{t.fillStyle=e.color,t.fillRect(e.x,e.y,e.w,e.h),t.fillStyle="rgba(0,0,0,0.3)",t.fillRect(e.x+5,e.y+5,e.w,e.h),"door"===e.type&&(t.fillStyle="#ffffff20",t.fillRect(e.x+10,e.y+10,e.w-20,e.h-20)),"belt"===e.type&&(t.strokeStyle="#ffffff40",t.beginPath(),t.moveTo(e.x,e.y+e.h/2),t.lineTo(e.x+e.w,e.y+e.h/2),t.stroke())})},[]),(0,a.jsxs)("div",{style:{position:"relative",width:800,height:600,background:"#3a3a3a",border:"2px solid #ffffff20",borderRadius:5,overflow:"hidden"},children:[(0,a.jsx)("canvas",{ref:l,width:800,height:600,style:{position:"absolute"}}),t&&t.map(e=>(0,a.jsx)(Player,{...e,isFinder:o.finder===e.id,isCurrent:n===e.id,onMove:r,gameState:o},e.id))]})}function VoiceControls(){let[e,t]=(0,i.useState)(!1);return(0,a.jsx)("div",{style:{position:"absolute",top:10,left:10,zIndex:10},children:(0,a.jsxs)("button",{onClick:()=>t(!e),style:{background:e?"#44ff44":"#ff4444",border:"none",padding:"5px 10px",borderRadius:5,cursor:"pointer"},children:["Mic ",e?"ON":"OFF"]})})}let checkWinCondition=(e,t)=>{if(e.found.length===t.length-1)return{status:"finished",winner:"finder"};let n=(new Date-new Date(e.startedAt))/1e3;return n>=e.timeLimit?{status:"finished",winner:"hiders"}:null};function Game(){let e=(0,o.useRouter)(),{code:t}=e.query,[n,l]=(0,i.useState)(null),[s,d]=(0,i.useState)([]),[c,u]=(0,i.useState)(!1),[h,p]=(0,i.useState)(!0),[f,x]=(0,i.useState)(null),[y,w]=(0,i.useState)(10),[g,b]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(!t)return;let fetchInitialData=async()=>{var e;let{data:n}=await r.O.from("games").select("*").eq("code",t).single();if(n&&(l(n.state),d(n.players),"playing"===n.state.status&&h)){u(!0),p(!1);let e=setInterval(()=>{w(t=>t<=1?(clearInterval(e),0):t-1)},1e3)}let{data:a}=await r.O.auth.getUser();x((null===(e=a.user)||void 0===e?void 0:e.id)||null)};fetchInitialData();let n=r.O.channel("games:code=eq.".concat(t)).on("postgres_changes",{event:"UPDATE",schema:"public",table:"games",filter:"code=eq.".concat(t)},n=>{l(n.new.state),d(n.new.players),"playing"===n.new.state.status&&h&&(u(!0),p(!1)),n.new.state.found.includes(f)&&!g&&(b(!0),setTimeout(()=>{e.push("/"),b(!1)},2e3));let a=checkWinCondition(n.new.state,n.new.players);a&&r.O.from("games").update({state:a}).eq("code",t)}).subscribe();return()=>{r.O.removeChannel(n)}},[t,h,f,e,g]);let handleMove=async(e,a)=>{let{data:i}=await r.O.auth.getUser(),o=i.user.id,l=s.map(t=>t.id===o?{...t,x:e,y:a}:t);if(n.finder===o&&0===y){let i=l.filter(t=>{if(t.id===o||n.found.includes(t.id))return!1;let i=t.x-e,r=t.y-a;return 40>Math.sqrt(i*i+r*r)}).map(e=>e.id);if(i.length>0){await r.O.from("games").update({players:l,state:{...n,found:[...n.found,...i]}}).eq("code",t);return}}await r.O.from("games").update({players:l}).eq("code",t)},m=(null==n?void 0:n.status)==="playing"?Math.max(0,n.timeLimit-Math.floor((new Date-new Date(n.startedAt))/1e3)):null,v=s.find(e=>e.id===(null==n?void 0:n.finder)),I=(null==v?void 0:v.username)||"Unknown";return(0,a.jsxs)("div",{style:{padding:20,position:"relative",width:"100vw",height:"100vh",overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center"},children:[(0,a.jsx)(VoiceControls,{}),(0,a.jsx)("button",{onClick:()=>e.push("/"),style:{position:"absolute",top:10,right:10,padding:"10px 20px"},children:"Exit"}),null!==m&&(0,a.jsxs)("div",{style:{position:"absolute",top:10,left:"50%",transform:"translateX(-50%)",color:"white",fontSize:20,fontWeight:"bold",textShadow:"1px 1px 2px #000"},children:["Time Left: ",Math.floor(m/60),":",(m%60).toString().padStart(2,"0")]}),y>0&&(null==n?void 0:n.status)==="playing"&&(0,a.jsxs)("div",{style:{position:"absolute",top:"20%",left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.8)",padding:20,borderRadius:10,color:"white",textAlign:"center",zIndex:10},children:[(0,a.jsx)("h2",{children:"Hiders: Run Away!"}),(0,a.jsxs)("p",{children:[y," seconds remaining"]})]}),n&&s.length>0&&f&&(0,a.jsx)(GameMap,{players:s,currentPlayerId:f,gameState:n,onMove:handleMove}),c&&(null==n?void 0:n.status)==="playing"&&(0,a.jsxs)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0,0,0,0.9)",padding:30,borderRadius:10,color:"white",textAlign:"center",zIndex:10,boxShadow:"0 0 10px rgba(255,255,255,0.3)"},children:[(0,a.jsx)("h2",{children:"The Finder Is..."}),(0,a.jsx)("p",{style:{fontSize:24,margin:"20px 0"},children:I}),(0,a.jsx)("div",{style:{width:40,height:40,background:(null==v?void 0:v.color)||"#888",borderRadius:"50%",margin:"0 auto 20px",border:"2px solid #fff"}}),(0,a.jsx)("button",{onClick:()=>u(!1),style:{padding:"10px 20px",background:"#44ff44",border:"none",borderRadius:5,cursor:"pointer"},children:"Start Playing"})]}),g&&(0,a.jsxs)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(255,0,0,0.9)",padding:30,borderRadius:10,color:"white",textAlign:"center",zIndex:10,boxShadow:"0 0 10px rgba(255,255,255,0.3)"},children:[(0,a.jsx)("h2",{children:"You Were Found and Eliminated!"}),(0,a.jsx)("p",{children:"Redirecting to home in 2 seconds..."})]}),(null==n?void 0:n.status)==="finished"&&(0,a.jsxs)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0,0,0,0.8)",padding:20,borderRadius:10,color:"white",textAlign:"center"},children:[(0,a.jsx)("h2",{children:"finder"===n.winner?"Finder Wins!":"Hiders Win!"}),(0,a.jsx)("button",{onClick:()=>e.push("/"),style:{padding:"10px 20px",marginTop:20},children:"Back to Home"})]})]})}}},function(e){e.O(0,[574,774,888,179],function(){return e(e.s=4592)}),_N_E=e.O()}]);